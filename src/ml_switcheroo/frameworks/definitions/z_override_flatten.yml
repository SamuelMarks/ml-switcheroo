operation: "Flatten"
description: "Flattens input by reshaping a range of dimensions into a single dimension."
# Explicitly marking as Array API ensures finding it via function calls like torch.flatten takes priority
op_type: "function"

std_args:
  - name: "input"
    type: "Tensor"
  - name: "start_dim"
    type: "int"
    default: "0"
  - name: "end_dim"
    type: "int"
    default: "-1"

variants:
  torch:
    api: "torch.flatten"

  jax:
    api: "jax.lax.collapse"
    requires_plugin: "flatten_range"
    # Ensure raw jax is imported
    required_imports:
      - "import jax"

  flax_nnx:
    api: "jax.lax.collapse"
    requires_plugin: "flatten_range"
    required_imports:
      - "import jax"

  # Fallback for others
  numpy:
    api: "numpy.reshape"
    requires_plugin: "flatten_range"
